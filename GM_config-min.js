/*
Copyright 2009+, GM_config Contributors (https://github.com/sizzlemctwizzle/GM_config)
GM_config is distributed under the terms of the GNU Lesser General Public License.
*/
// ==UserScript==
// @exclude       *
// @author        Mike Medley <medleymind@gmail.com> (https://github.com/sizzlemctwizzle/GM_config)
// @icon          https://raw.githubusercontent.com/sizzlemctwizzle/GM_config/master/gm_config_icon_large.png
// @name          GM_config
// @description   A lightweight, reusable, cross-browser graphical settings framework for inclusion in user scripts.
// @copyright     2009+, Mike Medley (https://github.com/sizzlemctwizzle)
// @license       LGPL-3.0; https://raw.githubusercontent.com/sizzlemctwizzle/GM_config/master/LICENSE
// ==/UserScript==
function GM_configStruct(){arguments.length&&(GM_configInit(this,arguments),this.onInit())}function GM_configInit(e,t){if(void 0===e.fields&&(e.fields={},e.onInit=e.onInit||function(){},e.onOpen=e.onOpen||function(){},e.onSave=e.onSave||function(){},e.onClose=e.onClose||function(){},e.onReset=e.onReset||function(){},e.isOpen=!1,e.title="User Script Settings",e.css={basic:"#GM_config * { font-family: arial,tahoma,myriad pro,sans-serif; }\n#GM_config { background: #FFF; }\n#GM_config input[type='radio'] { margin-right: 8px; }\n#GM_config .indent40 { margin-left: 40%; }\n#GM_config .field_label { font-size: 12px; font-weight: bold; margin-right: 6px; }\n#GM_config .radio_label { font-size: 12px; }\n#GM_config .block { display: block; }\n#GM_config .saveclose_buttons { margin: 16px 10px 10px; padding: 2px 12px; }\n#GM_config .reset, #GM_config .reset a, #GM_config_buttons_holder { color: #000; text-align: right; }\n#GM_config .config_header { font-size: 20pt; margin: 0; }\n#GM_config .config_desc, #GM_config .section_desc, #GM_config .reset { font-size: 9pt; }\n#GM_config .center { text-align: center; }\n#GM_config .section_header_holder { margin-top: 8px; }\n#GM_config .config_var { margin: 0 0 4px; }\n#GM_config .section_header { background: #414141; border: 1px solid #000; color: #FFF;\n font-size: 13pt; margin: 0; }\n#GM_config .section_desc { background: #EFEFEF; border: 1px solid #CCC; color: #575757; font-size: 9pt; margin: 0 0 6px; }\n",basicPrefix:"GM_config",stylish:""}),
1==t.length&&"string"==typeof t[0].id&&"function"!=typeof t[0].appendChild)n=t[0];else for(var i,n={},o=0,s=t.length;o<s;++o)if("function"!=typeof(i=t[o]).appendChild)switch(typeof i){case"object":for(var a in i){if("function"!=typeof i[a]){n.fields=i;break}n.events||(n.events={}),n.events[a]=i[a]}break;case"function":n.events={onOpen:i};break;case"string":/\w+\s*\{\s*\w+\s*:\s*\w+[\s|\S]*\}/.test(i)?n.css=i:n.title=i}else n.frame=i;if(n.id?e.id=n.id:void 0===e.id&&(e.id="GM_config"),n.title&&(e.title=n.title),n.css&&(e.css.stylish=n.css),n.frame&&(e.frame=n.frame),n.events){var r=n.events;for(var c in r)e["on"+c.charAt(0).toUpperCase()+c.slice(1)]=r[c]}if(n.fields){var l=e.read(),d=n.fields,f=n.types||{},u=e.id;for(var h in d){var p=d[h];p?e.fields[h]=new GM_configField(p,l[h],h,f[p.type],u):e.fields[h]&&delete e.fields[h]}}e.id!=e.css.basicPrefix&&(e.css.basic=e.css.basic.replace(RegExp("#"+e.css.basicPrefix,"gm"),"#"+e.id),e.css.basicPrefix=e.id)}function GM_configDefaultValue(e,t){var i;switch(0==e.indexOf("unsigned ")&&(e=e.substring(9)),e){case"radio":case"select":i=t[0];break;case"checkbox":i=!1;break;case"int":case"integer":case"float":case"number":i=0;break;default:i=""}return i}function GM_configField(e,t,i,n,o){this.settings=e,this.id=i,this.configId=o,this.node=null,this.wrapper=null,this.save=void 0===e.save||e.save,"button"==e.type&&(this.save=!1),this.default=void 0===e.default?n?n.default:GM_configDefaultValue(e.type,e.options):e.default,this.value=void 0===t?this.default:t,n&&(this.toNode=n.toNode,this.toValue=n.toValue,this.reset=n.reset)}
GM_configStruct.prototype={init:function(){GM_configInit(this,arguments),this.onInit()},open:function(){function e(e,t){var n=i.create,o=i.fields,s=i.id,a=n("div",{id:s+"_wrapper"});t.appendChild(n("style",{type:"text/css",textContent:i.css.basic+i.css.stylish})),a.appendChild(n("div",{id:s+"_header",className:"config_header block center"},i.title));var r=a,c=0;for(var l in o){var d=o[l],f=d.settings;f.section&&(r=a.appendChild(n("div",{className:"section_header_holder",id:s+"_section_"+c})),"[object Array]"!==Object.prototype.toString.call(f.section)&&(f.section=[f.section]),f.section[0]&&r.appendChild(n("div",{className:"section_header center",id:s+"_section_header_"+c},f.section[0])),f.section[1]&&r.appendChild(n("p",{className:"section_desc center",id:s+"_section_desc_"+c},f.section[1])),++c),r.appendChild(d.wrapper=d.toNode())}a.appendChild(n("div",{id:s+"_buttons_holder"},n("button",{id:s+"_saveBtn",textContent:"Save",title:"Save settings",className:"saveclose_buttons",onclick:function(){i.save()}}),n("button",{id:s+"_closeBtn",textContent:"Close",title:"Close window",className:"saveclose_buttons",onclick:function(){i.close()}}),n("div",{className:"reset_holder block"},n("a",{id:s+"_resetLink",textContent:"Reset to defaults",href:"#",title:"Reset fields to default values",className:"reset",onclick:function(e){e.preventDefault(),i.reset()}})))),e.appendChild(a),i.center(),window.addEventListener("resize",i.center,!1),i.onOpen(i.frame.contentDocument||i.frame.ownerDocument,i.frame.contentWindow||window,i.frame),window.addEventListener("beforeunload",function(){i.close()
},!1),i.frame.style.display="block",i.isOpen=!0}var t=document.getElementById(this.id);if(!t||!("IFRAME"==t.tagName||t.childNodes.length>0)){var i=this,n="bottom: auto; border: 1px solid #000; display: none; height: 75%; left: 0; margin: 0; max-height: 95%; max-width: 95%; opacity: 0; overflow: auto; padding: 0; position: fixed; right: auto; top: 0; width: 75%; z-index: 9999;";this.frame?(this.frame.id=this.id,this.frame.setAttribute("style",n),e(this.frame,this.frame.ownerDocument.getElementsByTagName("head")[0])):(document.body.appendChild(this.frame=this.create("iframe",{id:this.id,style:n})),this.frame.src="about:blank",this.frame.addEventListener("load",function(t){var n=i.frame,o=n.contentDocument.getElementsByTagName("body")[0];o.id=i.id,e(o,n.contentDocument.getElementsByTagName("head")[0])},!1))}},save:function(){var e=this.write();this.onSave(e)},close:function(){this.frame.contentDocument?(this.remove(this.frame),this.frame=null):(this.frame.innerHTML="",this.frame.style.display="none");var e=this.fields;for(var t in e){var i=e[t];i.wrapper=null,i.node=null}this.onClose(),this.isOpen=!1},set:function(e,t){this.fields[e].value=t,this.fields[e].node&&this.fields[e].reload()},get:function(e,t){var i=this.fields[e],n=null;return t&&i.node&&(n=i.toValue()),null!=n?n:i.value},write:function(e,t){if(!t){var i={},n={},o=this.fields;for(var s in o){var a=o[s],r=a.toValue();a.save?null!=r?(i[s]=r,a.value=r):i[s]=a.value:n[s]=r}}try{this.setValue(e||this.id,this.stringify(t||i))}catch(e){this.log("GM_config failed to save settings!")}return n},read:function(e){try{
t=this.parser(this.getValue(e||this.id,"{}"))}catch(e){this.log("GM_config failed to read saved settings!");var t={}}return t},reset:function(){var e=this.fields;for(var t in e)e[t].reset();this.onReset()},create:function(){switch(arguments.length){case 1:e=document.createTextNode(arguments[0]);break;default:var e=document.createElement(arguments[0]),t=arguments[1];for(var i in t)0==i.indexOf("on")?e.addEventListener(i.substring(2),t[i],!1):-1!=",style,accesskey,id,name,src,href,which,for".indexOf(","+i.toLowerCase())?e.setAttribute(i,t[i]):e[i]=t[i];if("string"==typeof arguments[2])e.innerHTML=arguments[2];else for(var n=2,o=arguments.length;n<o;++n)e.appendChild(arguments[n])}return e},center:function(){var e=this.frame;if(e){var t=e.style;t.opacity,"none"==t.display&&(t.opacity="0"),t.display="",t.top=Math.floor(window.innerHeight/2-e.offsetHeight/2)+"px",t.left=Math.floor(window.innerWidth/2-e.offsetWidth/2)+"px",t.opacity="1"}},remove:function(e){e&&e.parentNode&&e.parentNode.removeChild(e)}},function(){var e,t,i,n,o="undefined"!=typeof GM_getValue&&void 0!==GM_getValue("a","b");o?(e=GM_setValue,t=GM_getValue,i=void 0===JSON?function(e){return e.toSource()}:JSON.stringify,n=void 0===JSON?function(e){return Function("return "+e+";")()}:JSON.parse):(e=function(e,t){return localStorage.setItem(e,t)},t=function(e,t){var i=localStorage.getItem(e);return null==i?t:i},i=JSON.stringify,n=JSON.parse),GM_configStruct.prototype.isGM=o,GM_configStruct.prototype.setValue=e,GM_configStruct.prototype.getValue=t,GM_configStruct.prototype.stringify=i,GM_configStruct.prototype.parser=n,
GM_configStruct.prototype.log=window.console?console.log:o&&"undefined"!=typeof GM_log?GM_log:window.opera?opera.postError:function(){}}(),GM_configField.prototype={create:GM_configStruct.prototype.create,toNode:function(){function e(e,t,i,n){switch(n||(n=i.firstChild),e){case"right":case"below":"below"==e&&i.appendChild(l("br",{})),i.appendChild(t);break;default:"above"==e&&i.insertBefore(l("br",{}),n),i.insertBefore(t,n)}}var t,i=this.settings,n=this.value,o=i.options,s=i.type,a=this.id,r=this.configId,c=i.labelPos,l=this.create,d=l("div",{className:"config_var",id:r+"_"+a+"_var",title:i.title||""});for(var f in i){t=f;break}var u=i.label&&"button"!=s?l("label",{id:r+"_"+a+"_field_label",for:r+"_field_"+a,className:"field_label"},i.label):null;switch(s){case"textarea":d.appendChild(this.node=l("textarea",{innerHTML:n,id:r+"_field_"+a,className:"block",cols:i.cols?i.cols:20,rows:i.rows?i.rows:2}));break;case"radio":v=l("div",{id:r+"_field_"+a}),this.node=v;for(var f=0,h=o.length;f<h;++f){var p=l("label",{className:"radio_label"},o[f]),g=v.appendChild(l("input",{value:o[f],type:"radio",name:a,checked:o[f]==n}));e(!c||"left"!=c&&"right"!=c?"options"==t?"left":"right":c,p,v,g)}d.appendChild(v);break;case"select":var v=l("select",{id:r+"_field_"+a});this.node=v;for(var f=0,h=o.length;f<h;++f){var _=o[f];v.appendChild(l("option",{value:_,selected:_==n},_))}d.appendChild(v);break;default:var b={id:r+"_field_"+a,type:s,value:"button"==s?i.label:n};switch(s){case"checkbox":b.checked=n;break;case"button":b.size=i.size?i.size:25,i.script&&(i.click=i.script),
i.click&&(b.onclick=i.click);break;case"hidden":break;default:b.type="text",b.size=i.size?i.size:25}d.appendChild(this.node=l("input",b))}return u&&(c||(c="label"==t||"radio"==s?"left":"right"),e(c,u,d)),d},toValue:function(){var e=this.node,t=this.settings,i=t.type,n=!1,o=null;if(!e)return o;switch(0==i.indexOf("unsigned ")&&(i=i.substring(9),n=!0),i){case"checkbox":o=e.checked;break;case"select":o=e[e.selectedIndex].value;break;case"radio":for(var s=e.getElementsByTagName("input"),a=0,r=s.length;a<r;++a)s[a].checked&&(o=s[a].value);break;case"button":break;case"int":case"integer":case"float":case"number":var c=+e.value,l='Field labeled "'+t.label+'" expects a'+(n?" positive ":"n ")+"integer value";if(isNaN(c)||"int"==i.substr(0,3)&&Math.ceil(c)!=Math.floor(c)||n&&c<0)return alert(l+"."),null;if(!this._checkNumberRange(c,l))return null;o=c;break;default:o=e.value}return o},reset:function(){var e=this.node,t=this.settings.type;if(e)switch(t){case"checkbox":e.checked=this.default;break;case"select":for(var i=0,n=e.options.length;i<n;++i)e.options[i].textContent==this.default&&(e.selectedIndex=i);break;case"radio":for(var o=e.getElementsByTagName("input"),i=0,n=o.length;i<n;++i)o[i].value==this.default&&(o[i].checked=!0);break;case"button":break;default:e.value=this.default}},remove:function(e){GM_configStruct.prototype.remove(e||this.wrapper),this.wrapper=null,this.node=null},reload:function(){var e=this.wrapper;e&&(e.parentNode.insertBefore(this.wrapper=this.toNode(),e),this.remove(e))},_checkNumberRange:function(e,t){var i=this.settings
;return"number"==typeof i.min&&e<i.min?(alert(t+" greater than or equal to "+i.min+"."),null):!("number"==typeof i.max&&e>i.max)||(alert(t+" less than or equal to "+i.max+"."),null)}};var GM_config=new GM_configStruct;
